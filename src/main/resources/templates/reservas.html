<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Gerenciamento de Reservas</title>
    <script src="/js/authInterceptor.js"></script>
    <script>
        let currentEditId = null;

        async function fetchReservas() {
            const response = await fetch('/api/reservas');
            if (!response.ok) {
                alert('Erro ao buscar reservas. Verifique se está autenticado.');
                return;
            }
            const reservas = await response.json();
            const list = document.getElementById('reserva-list');
            list.innerHTML = '';
            reservas.forEach(reserva => {
                const item = document.createElement('li');
                item.textContent = `Código: ${reserva.codigoReserva} - Abrigo: ${reserva.abrigo.nomeLocal} - Usuário: ${reserva.usuario.nome} - Status: ${reserva.status}`;

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Excluir';
                deleteButton.onclick = () => deleteReserva(reserva.id);
                item.appendChild(deleteButton);

                list.appendChild(item);
            });
        }

        async function createReserva(event) {
            event.preventDefault();
            const form = event.target;
            const data = {
                usuarioId: form.usuarioId.value,
                abrigoId: form.abrigoId.value,
                dataReserva: form.dataReserva.value
            };
            const response = await fetch('/api/reservas', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            if (response.ok) {
                alert('Reserva criada com sucesso!');
                form.reset();
                fetchReservas();
            } else {
                alert('Erro ao criar reserva.');
            }
        }

        async function deleteReserva(id) {
            if (!confirm('Tem certeza que deseja excluir esta reserva?')) {
                return;
            }
            const response = await fetch(`/api/reservas/${id}`, {
                method: 'DELETE'
            });
            if (response.ok) {
                alert('Reserva excluída com sucesso!');
                fetchReservas();
            } else {
                alert('Erro ao excluir reserva.');
            }
        }

        window.onload = () => {
            fetchReservas();
            const form = document.getElementById('reserva-form');
            form.addEventListener('submit', createReserva);
        };
    </script>
</head>
<body>
    <h1>Gerenciamento de Reservas</h1>
    <h2>Lista de Reservas</h2>
    <ul id="reserva-list"></ul>

    <h2>Criar Reserva</h2>
    <form id="reserva-form">
        <label>Usuário ID: <input type="text" name="usuarioId" required></label><br>
        <label>Abrigo ID: <input type="text" name="abrigoId" required></label><br>
        <label>Data da Reserva: <input type="date" name="dataReserva" required></label><br>
        <button type="submit">Criar Reserva</button>
    </form>
</body>
</html>
