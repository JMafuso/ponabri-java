<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Reservas Management</title>
    <script>
        async function fetchReservas() {
            const response = await fetch('/api/reservas');
            const reservas = await response.json();
            const list = document.getElementById('reserva-list');
            list.innerHTML = '';
            reservas.forEach(reserva => {
                const item = document.createElement('li');
                item.textContent = `Reserva ${reserva.codigoReserva} - Abrigo ID: ${reserva.abrigoId} - Usuário ID: ${reserva.usuarioId} - Pessoas: ${reserva.quantidadePessoas}`;
                list.appendChild(item);
            });
        }

        async function fetchAbrigos() {
            const response = await fetch('/api/abrigos');
            const abrigos = await response.json();
            const select = document.getElementById('abrigo-select');
            select.innerHTML = '';
            abrigos.forEach(abrigo => {
                const option = document.createElement('option');
                option.value = abrigo.id;
                option.textContent = `${abrigo.nomeLocal} - ${abrigo.endereco}`;
                select.appendChild(option);
            });
        }

        async function createReserva(event) {
            event.preventDefault();
            const form = event.target;
            const data = {
                usuarioId: parseInt(form.usuarioId.value),
                abrigoId: parseInt(form['abrigo-select'].value),
                quantidadePessoas: parseInt(form.quantidadePessoas.value),
                usouVagaCarro: form.usouVagaCarro.checked
            };
            const response = await fetch('/api/reservas', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            if (response.ok) {
                const reserva = await response.json();
                alert('Reserva criada com sucesso! Código da reserva: ' + reserva.codigoReserva);
                form.reset();
                fetchReservas();
            } else {
                alert('Erro ao criar reserva.');
            }
        }

        window.onload = () => {
            fetchReservas();
            fetchAbrigos();
            document.getElementById('reserva-form').addEventListener('submit', createReserva);
        };
    </script>
</head>
<body>
    <h1>Gerenciamento de Reservas</h1>
    <h2>Lista de Reservas</h2>
    <ul id="reserva-list"></ul>

    <h2>Criar Nova Reserva</h2>
    <form id="reserva-form">
        <label>ID do Usuário: <input type="number" name="usuarioId" required></label><br>
        <label>Abrigo: 
            <select id="abrigo-select" name="abrigo-select" required>
                <!-- Options populated dynamically -->
            </select>
        </label><br>
        <label>Quantidade de Pessoas: <input type="number" name="quantidadePessoas" required></label><br>
        <label>Usou Vaga de Carro: <input type="checkbox" name="usouVagaCarro"></label><br>
        <button type="submit">Criar Reserva</button>
    </form>
</body>
</html>
